<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Test</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background: #1a1a1a;
      color: #e0e0e0;
    }
    .test-section {
      margin: 20px 0;
      padding: 20px;
      background: #2a2a2a;
      border-radius: 8px;
    }
    button {
      background: #4a90e2;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
    }
    button:hover {
      background: #357abd;
    }
    .result {
      margin-top: 15px;
      padding: 15px;
      background: #1a1a1a;
      border-radius: 4px;
      font-family: monospace;
      white-space: pre-wrap;
      word-break: break-all;
    }
    .success { border-left: 4px solid #4caf50; }
    .error { border-left: 4px solid #f44336; }
    .pending { border-left: 4px solid #ff9800; }
    input {
      padding: 8px;
      margin: 10px 0;
      width: 300px;
      background: #3a3a3a;
      border: 1px solid #555;
      color: white;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h1>Football-Data.org API Test</h1>
  
  <div class="test-section">
    <h2>API Key Setup</h2>
    <input type="password" id="apiKey" placeholder="Enter your API key">
    <button onclick="saveApiKey()">Save API Key</button>
    <button onclick="loadApiKey()">Load Saved Key</button>
    <div id="keyResult" class="result"></div>
  </div>

  <div class="test-section">
    <h2>Test Direct API (Will fail with CORS)</h2>
    <button onclick="testDirectAPI()">Test Direct API</button>
    <div id="directResult" class="result"></div>
  </div>

  <div class="test-section">
    <h2>Test Proxy API (Should work)</h2>
    <button onclick="testProxyAPI()">Test Proxy API</button>
    <div id="proxyResult" class="result"></div>
  </div>

  <script>
    function saveApiKey() {
      const apiKey = document.getElementById('apiKey').value;
      if (!apiKey) {
        showResult('keyResult', 'Please enter an API key', 'error');
        return;
      }
      localStorage.setItem('football_data_api_key', apiKey);
      showResult('keyResult', 'API key saved to localStorage', 'success');
    }

    function loadApiKey() {
      const apiKey = localStorage.getItem('football_data_api_key');
      if (apiKey) {
        document.getElementById('apiKey').value = apiKey;
        showResult('keyResult', 'API key loaded from localStorage', 'success');
      } else {
        showResult('keyResult', 'No API key found in localStorage', 'error');
      }
    }

    function showResult(elementId, message, type = 'pending') {
      const element = document.getElementById(elementId);
      element.className = `result ${type}`;
      element.textContent = message;
    }

    async function testDirectAPI() {
      const apiKey = document.getElementById('apiKey').value || localStorage.getItem('football_data_api_key');
      if (!apiKey) {
        showResult('directResult', 'Please enter or save an API key first', 'error');
        return;
      }

      showResult('directResult', 'Testing direct API call...', 'pending');
      
      try {
        const response = await fetch('https://api.football-data.org/v4/competitions/2021', {
          headers: {
            'X-Auth-Token': apiKey
          },
          mode: 'cors'
        });

        const data = await response.json();
        showResult('directResult', 
          `Success! Status: ${response.status}\n\n${JSON.stringify(data, null, 2)}`, 
          'success'
        );
      } catch (error) {
        showResult('directResult', 
          `Error (Expected due to CORS):\n${error.message}`, 
          'error'
        );
      }
    }

    async function testProxyAPI() {
      const apiKey = document.getElementById('apiKey').value || localStorage.getItem('football_data_api_key');
      if (!apiKey) {
        showResult('proxyResult', 'Please enter or save an API key first', 'error');
        return;
      }

      showResult('proxyResult', 'Testing proxy API call...', 'pending');
      
      try {
        const response = await fetch('/api/football-data/competitions/2021', {
          method: 'GET',
          headers: {
            'X-Auth-Token': apiKey,
            'Accept': 'application/json'
          },
          mode: 'same-origin'
        });

        const data = await response.json();
        
        if (response.ok) {
          showResult('proxyResult', 
            `Success! Status: ${response.status}\n\nCompetition: ${data.name}\nSeason: ${data.currentSeason.startDate} to ${data.currentSeason.endDate}\nMatchday: ${data.currentSeason.currentMatchday}\n\nFull Response:\n${JSON.stringify(data, null, 2)}`, 
            'success'
          );
        } else {
          showResult('proxyResult', 
            `API Error: ${response.status} ${response.statusText}\n\n${JSON.stringify(data, null, 2)}`, 
            'error'
          );
        }
      } catch (error) {
        showResult('proxyResult', 
          `Network Error:\n${error.message}`, 
          'error'
        );
      }
    }

    // Load API key on page load
    window.addEventListener('load', () => {
      loadApiKey();
    });
  </script>
</body>
</html>